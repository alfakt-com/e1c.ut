
Процедура ДействияФормыЭкспорт(Кнопка)
	Попытка
		ТС = ЭлементыФормы.СправочникСписок.ТекущаяСтрока;
		Объект = ТС.Ссылка.ПолучитьОбъект();
	Исключение
		Сообщить(ОписаниеОшибки());
		Возврат;
	КонецПопытки;
		
	ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	ДиалогОткрытияФайла.Заголовок = "Выберите каталог экспорта";
	Если НЕ ДиалогОткрытияФайла.Выбрать() Тогда
	    Предупреждение("Каталог не выбран");
		Возврат;
	КонецЕсли;
	ИмяФайла = ДиалогОткрытияФайла.Каталог + "\" + СокрЛП(Строка(Объект.Код)) + ".xml";

	ЗФайла = Новый ЗаписьXML;
	ЗФайла.ОткрытьФайл(ИмяФайла);
	ЗФайла.ЗаписатьОбъявлениеXML();
	ЗФайла.ЗаписатьНачалоЭлемента("body");
	ЗаписатьXML(ЗФайла, Объект);
	ЗФайла.ЗаписатьКонецЭлемента();
	ЗФайла.Закрыть();
	
	Сообщить("Объект: " + Объект);
	Сообщить("Выгружен в файл: " + ИмяФайла);
КонецПроцедуры

Процедура ДействияФормыИмпорт(Кнопка)
	ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	Фильтр = "(*.xml)|*.xml";
	ДиалогОткрытияФайла.Фильтр = Фильтр;
	ДиалогОткрытияФайла.МножественныйВыбор = ЛОжь;
	ДиалогОткрытияФайла.Заголовок = "Выберите файл импорта";
	Если НЕ ДиалогОткрытияФайла.Выбрать() Тогда
	    Предупреждение("Каталог не выбран");
		Возврат;
	КонецЕсли;
	ИмяФайла = ДиалогОткрытияФайла.ПолноеИмяФайла;
	
	ЗФайла = Новый ЧтениеXML;
	ЗФайла.ОткрытьФайл(ИмяФайла);
	ЗФайла.Прочитать();
	Пока ЗФайла.Прочитать() Цикл
		Если ВозможностьЧтенияXML(ЗФайла) Тогда
			Попытка
				О=ПрочитатьXML(ЗФайла);
				О.ОбменДанными.Загрузка = Истина;
				О.Записать();
				Сообщить("Объект загружен: " + О.Ссылка);
			Исключение
				Сообщить(ОписаниеОшибки());
			КонецПопытки;
		КонецЕсли;
	КонецЦикла;
	ЗФайла.Закрыть();
КонецПроцедуры
