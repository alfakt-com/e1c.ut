// Форма используется для
// - Настройки параметров подключения к ИС ЭСФ


////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ПараметрыПодключения = ВССервер.ПолучитьПараметрыПодключенияКСерверуВС();
	
	СерверВС_HTTPS = ПараметрыПодключения.СерверВС_HTTPS;
	СерверВС_Адрес = ПараметрыПодключения.СерверВС_Адрес;	
	СерверВС_ПолныйАдрес = ПараметрыПодключения.СерверВС_ПолныйАдрес;
	СерверВС_Порт = ПараметрыПодключения.СерверВС_Порт;
	СерверВС_Ресурс = ПараметрыПодключения.СерверВС_Ресурс;
	СерверВС_Таймаут = ПараметрыПодключения.СерверВС_Таймаут;
		
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Контейнер = ВСКлиентСервер.КонтейнерМетодов();	
	Контейнер.ПриОткрытииФормы(ЭтаФорма, Отказ);
	Если Отказ Тогда
		Возврат;
	КонецЕсли;	
	
	УправлениеФормой();
	
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ

&НаКлиенте
Процедура ОК(Команда)
	
	СохранитьНастройкиПодключения();
	Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура Отмена(Команда)
	Закрыть();
КонецПроцедуры

&НаКлиенте
Процедура Заполнить(Команда)
	
	ЗаполнитьНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьНаСервере()
	
	СерверВС_HTTPS = "";
	СерверВС_Адрес = "";
	СерверВС_Порт = "";
	СерверВС_Ресурс = "";
	СерверВС_Таймаут = 0;
	
	Попытка
		
		ПараметрыПодключения = ВССервер.ПараметрыПодключенияКСерверуВС(СерверВС_ПолныйАдрес);
		
		СерверВС_HTTPS = ПараметрыПодключения.HTTPS;
		СерверВС_Адрес = ПараметрыПодключения.Адрес;
		СерверВС_Порт = ПараметрыПодключения.Порт;
		СерверВС_Ресурс = ПараметрыПодключения.Ресурс;
		
		
	Исключение
		
		Сообщить(НСтр("ru = 'Не удалось разобрать адрес сервера на составные части.'"));
		
	КонецПопытки;
	
КонецПроцедуры

&НаКлиенте
Процедура Восстановить(Команда)
	
	ВосстановитьИЗаполнить();
	
КонецПроцедуры

&НаСервере
Процедура ВосстановитьИЗаполнить()
	
	ОбработкаОбменЭСФ = ЭСФСерверПовтИсп.ОбработкаОбменЭСФ();
	СерверВС_ПолныйАдрес = ОбработкаОбменЭСФ.АдресСервераAPIВС();	
	
	ЗаполнитьНаСервере();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

&НаКлиенте
Процедура УправлениеФормой()
	
		
КонецПроцедуры

&НаСервере
Процедура СохранитьНастройкиПодключения()
	
	ПараметрыПодключения = ВССервер.ПустыеПараметрыПодключенияКСерверуВС();
	
	ПараметрыПодключения.СерверВС_HTTPS = СерверВС_HTTPS;
	ПараметрыПодключения.СерверВС_Адрес = СерверВС_Адрес;
	ПараметрыПодключения.СерверВС_ПолныйАдрес = СерверВС_ПолныйАдрес;
	ПараметрыПодключения.СерверВС_Порт = СерверВС_Порт;
	ПараметрыПодключения.СерверВС_Ресурс = СерверВС_Ресурс;
	ПараметрыПодключения.СерверВС_Таймаут = СерверВС_Таймаут;
	
	ВССервер.СохранитьПараметрыПодключенияКСерверуВС(ПараметрыПодключения);
	
КонецПроцедуры


